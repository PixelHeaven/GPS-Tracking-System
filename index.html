watchId = navigator.geolocation.watchPosition(
  (position) => {
    const lat = position.coords.latitude;
    const lon = position.coords.longitude;
    const acc = position.coords.accuracy; // in meters

    // Optional filter: only include accurate points
    if (acc > 25) {
      console.log(`Skipped inaccurate point: ${acc}m`);
      return;
    }

    const coordStr = `${lon},${lat},0`; // KML wants lon,lat,alt
    coordinates.push(coordStr);

    const logItem = document.createElement("li");
    logItem.textContent = `Lat: ${lat.toFixed(5)}, Lon: ${lon.toFixed(5)} (Â±${Math.round(acc)}m)`;
    document.getElementById("log").appendChild(logItem);
  },
  (err) => {
    alert("Error getting position: " + err.message);
  },
  {
    enableHighAccuracy: true,
    timeout: 5000,       // shorter timeout
    maximumAge: 0        // don't use old locations
  }
);
